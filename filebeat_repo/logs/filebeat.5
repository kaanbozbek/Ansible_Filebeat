2022-04-26T13:42:18.698+0300	INFO	instance/beat.go:665	Home path: [C:\tools\filebeat-iislog-all-new] Config path: [C:\tools\filebeat-iislog-all-new] Data path: [C:\tools\filebeat-iislog-all-new\data] Logs path: [C:\tools\filebeat-iislog-all-new\logs]
2022-04-26T13:42:18.699+0300	DEBUG	[beat]	instance/beat.go:723	Beat metadata path: C:\tools\filebeat-iislog-all-new\data\meta.json
2022-04-26T13:42:18.699+0300	INFO	instance/beat.go:673	Beat ID: 3d35264c-9a58-4657-b8bb-bcc81d21833f
2022-04-26T13:42:18.705+0300	DEBUG	[conditions]	conditions/conditions.go:98	New condition contains: map[]
2022-04-26T13:42:18.705+0300	DEBUG	[conditions]	conditions/conditions.go:98	New condition !contains: map[]
2022-04-26T13:42:18.706+0300	DEBUG	[add_cloud_metadata]	add_cloud_metadata/providers.go:128	add_cloud_metadata: starting to fetch metadata, timeout=3s
2022-04-26T13:42:18.706+0300	DEBUG	[docker]	docker/client.go:48	Docker client will negotiate the API version on the first request.
2022-04-26T13:42:18.706+0300	DEBUG	[add_docker_metadata]	add_docker_metadata/add_docker_metadata.go:86	add_docker_metadata: docker environment not detected: protocol not available
2022-04-26T13:42:18.707+0300	DEBUG	[kubernetes]	add_kubernetes_metadata/kubernetes.go:138	Could not create kubernetes client using in_cluster config: unable to build kube config due to error: invalid configuration: no configuration has been provided, try setting KUBERNETES_MASTER environment variable	{"libbeat.processor": "add_kubernetes_metadata"}
2022-04-26T13:42:21.706+0300	DEBUG	[add_cloud_metadata]	add_cloud_metadata/providers.go:172	add_cloud_metadata: timed-out waiting for all responses
2022-04-26T13:42:21.706+0300	DEBUG	[add_cloud_metadata]	add_cloud_metadata/providers.go:131	add_cloud_metadata: fetchMetadata ran for 3.0005591s
2022-04-26T13:42:21.706+0300	INFO	[add_cloud_metadata]	add_cloud_metadata/add_cloud_metadata.go:101	add_cloud_metadata: hosting provider type not detected.
2022-04-26T13:42:21.706+0300	DEBUG	[processors]	processors/processor.go:120	Generated new processors: add_host_metadata=[netinfo.enabled=[true], cache.ttl=[5m0s]], condition=!contains: map[], add_cloud_metadata={}, add_docker_metadata=[match_fields=[] match_pids=[process.pid, process.ppid]], add_kubernetes_metadata
2022-04-26T13:42:21.706+0300	INFO	[beat]	instance/beat.go:1014	Beat info	{"system_info": {"beat": {"path": {"config": "C:\\tools\\filebeat-iislog-all-new", "data": "C:\\tools\\filebeat-iislog-all-new\\data", "home": "C:\\tools\\filebeat-iislog-all-new", "logs": "C:\\tools\\filebeat-iislog-all-new\\logs"}, "type": "filebeat", "uuid": "3d35264c-9a58-4657-b8bb-bcc81d21833f"}}}
2022-04-26T13:42:21.706+0300	INFO	[beat]	instance/beat.go:1023	Build info	{"system_info": {"build": {"commit": "5ae799cb1c3c490c9a27b14cb463dc23696bc7d3", "libbeat": "7.15.1", "time": "2021-10-07T22:06:50.000Z", "version": "7.15.1"}}}
2022-04-26T13:42:21.706+0300	INFO	[beat]	instance/beat.go:1026	Go runtime info	{"system_info": {"go": {"os":"windows","arch":"amd64","max_procs":2,"version":"go1.16.6"}}}
2022-04-26T13:42:21.714+0300	INFO	[beat]	instance/beat.go:1030	Host info	{"system_info": {"host": {"architecture":"x86_64","boot_time":"2022-03-22T15:52:42.62+03:00","name":"VDFWEBT01","ip":["10.112.118.52/24","::1/128","127.0.0.1/8"],"kernel_version":"10.0.17763.2565 (WinBuild.160101.0800)","mac":["00:50:56:ae:1f:fa"],"os":{"type":"windows","family":"windows","platform":"windows","name":"Windows Server 2019 Standard","version":"10.0","major":10,"minor":0,"patch":0,"build":"17763.2565"},"timezone":"+03","timezone_offset_sec":10800,"id":"f1f58683-63c0-459a-9444-cff17adbcd5a"}}}
2022-04-26T13:42:21.715+0300	INFO	[beat]	instance/beat.go:1059	Process info	{"system_info": {"process": {"cwd": "C:\\tools\\filebeat-iislog-all-new", "exe": "C:\\tools\\filebeat-iislog-all-new\\filebeat.exe", "name": "filebeat.exe", "pid": 11516, "ppid": 2084, "start_time": "2022-04-26T13:42:18.468+0300"}}}
2022-04-26T13:42:21.715+0300	INFO	instance/beat.go:309	Setup Beat: filebeat; Version: 7.15.1
2022-04-26T13:42:21.715+0300	DEBUG	[beat]	instance/beat.go:335	Initializing output plugins
2022-04-26T13:42:21.715+0300	WARN	[cfgwarn]	tlscommon/config.go:100	DEPRECATED: Treating the CommonName field on X.509 certificates as a host name when no Subject Alternative Names are present is going to be removed. Please update your certificates if needed. Will be removed in version: 8.0.0
2022-04-26T13:42:21.716+0300	INFO	[esclientleg]	eslegclient/connection.go:100	elasticsearch url: https://10.112.116.167:9200
2022-04-26T13:42:21.716+0300	WARN	[tls]	tlscommon/tls_config.go:98	SSL/TLS verifications disabled.
2022-04-26T13:42:21.716+0300	DEBUG	[publisher]	pipeline/consumer.go:148	start pipeline event consumer
2022-04-26T13:42:21.716+0300	INFO	[publisher]	pipeline/module.go:113	Beat name: VDFWEBT01
2022-04-26T13:42:21.718+0300	INFO	beater/filebeat.go:117	Enabled modules/filesets: iis (access, error)
2022-04-26T13:42:21.720+0300	INFO	[esclientleg]	eslegclient/connection.go:100	elasticsearch url: https://10.112.116.167:9200
2022-04-26T13:42:21.720+0300	WARN	[tls]	tlscommon/tls_config.go:98	SSL/TLS verifications disabled.
2022-04-26T13:42:21.720+0300	DEBUG	[esclientleg]	eslegclient/connection.go:249	ES Ping(url=https://10.112.116.167:9200)
2022-04-26T13:42:21.720+0300	WARN	[tls]	tlscommon/tls_config.go:98	SSL/TLS verifications disabled.
2022-04-26T13:42:21.730+0300	DEBUG	[esclientleg]	transport/logging.go:41	Completed dialing successfully	{"network": "tcp", "address": "10.112.116.167:9200"}
2022-04-26T13:42:21.731+0300	DEBUG	[esclientleg]	eslegclient/connection.go:272	Ping status code: 200
2022-04-26T13:42:21.731+0300	INFO	[esclientleg]	eslegclient/connection.go:273	Attempting to connect to Elasticsearch version 7.15.1
2022-04-26T13:42:21.731+0300	DEBUG	[cfgfile]	cfgfile/reload.go:246	Scan for config files
2022-04-26T13:42:21.732+0300	DEBUG	[cfgfile]	cfgfile/cfgfile.go:193	Load config from file: C:\tools\filebeat-iislog-all-new\modules.d\iis.yml
2022-04-26T13:42:21.732+0300	DEBUG	[cfgfile]	cfgfile/reload.go:255	Number of module configs found: 1
2022-04-26T13:42:21.732+0300	DEBUG	[load]	cfgfile/list.go:63	Starting reload procedure, current runners: 0
2022-04-26T13:42:21.732+0300	DEBUG	[load]	cfgfile/list.go:81	Start list: 1, Stop list: 0
2022-04-26T13:42:21.733+0300	DEBUG	[load]	cfgfile/list.go:105	Starting runner: iis (access, error)
2022-04-26T13:42:21.733+0300	DEBUG	[modules]	fileset/setup.go:71	Loading ingest pipelines for modules from modules.d
2022-04-26T13:42:21.733+0300	INFO	[esclientleg]	eslegclient/connection.go:100	elasticsearch url: https://10.112.116.167:9200
2022-04-26T13:42:21.733+0300	WARN	[tls]	tlscommon/tls_config.go:98	SSL/TLS verifications disabled.
2022-04-26T13:42:21.733+0300	DEBUG	[esclientleg]	eslegclient/connection.go:249	ES Ping(url=https://10.112.116.167:9200)
2022-04-26T13:42:21.733+0300	WARN	[tls]	tlscommon/tls_config.go:98	SSL/TLS verifications disabled.
2022-04-26T13:42:21.741+0300	DEBUG	[esclientleg]	transport/logging.go:41	Completed dialing successfully	{"network": "tcp", "address": "10.112.116.167:9200"}
2022-04-26T13:42:21.742+0300	DEBUG	[esclientleg]	eslegclient/connection.go:272	Ping status code: 200
2022-04-26T13:42:21.742+0300	INFO	[esclientleg]	eslegclient/connection.go:273	Attempting to connect to Elasticsearch version 7.15.1
2022-04-26T13:42:21.742+0300	DEBUG	[modules]	fileset/pipelines.go:67	Required processors: [{user_agent ingest-user-agent} {geoip ingest-geoip}]
2022-04-26T13:42:21.742+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	GET https://10.112.116.167:9200/_nodes/ingest  <nil>
2022-04-26T13:42:21.745+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	PUT https://10.112.116.167:9200/_ingest/pipeline/filebeat-7.15.1-iis-access-pipeline  map[description:Pipeline for parsing IIS access logs. Requires the geoip and user_agent plugins. on_failure:[map[set:map[field:error.message value:{{ _ingest.on_failure_message }}]]] processors:[map[set:map[field:event.ingested value:{{_ingest.timestamp}}]] map[rename:map[field:message target_field:event.original]] map[grok:map[field:event.original ignore_missing:true patterns:[%{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{NOTSPACE:iis.access.site_name}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:iis.access.cookie}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NOTSPACE:destination.domain}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{NOTSPACE:iis.access.site_name}) (?:-|%{NOTSPACE:iis.access.server_name}) (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|HTTP/%{NUMBER:http.version}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:iis.access.cookie}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NOTSPACE:destination.domain}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} \[%{IPORHOST:destination.address}\]\(http://%{IPORHOST:destination.address}\) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) \[%{IPORHOST:source.address}\]\(http://%{IPORHOST:source.address}\) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{IPORHOST:network.forwarded_ip})? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes})]]] map[uri_parts:map[field:_tmp.url_path ignore_failure:true]] map[set:map[field:url.original if:ctx?._tmp?.url_path != null && ctx?.url?.original == null ignore_failure:true value:{{_tmp.url_path}}]] map[urldecode:map[field:_tmp.url_query if:ctx.url?.query == null ignore_failure:true ignore_missing:true target_field:url.query]] map[set:map[field:url.domain if:ctx.url?.domain == null && ctx.destination?.domain != null value:{{destination.domain}}]] map[remove:map[field:[_tmp] ignore_missing:true]] map[rename:map[field:@timestamp target_field:event.created]] map[date:map[field:iis.access.time formats:[yyyy-MM-dd HH:mm:ss] target_field:@timestamp]] map[remove:map[field:iis.access.time]] map[script:map[if:ctx.temp?.duration != null lang:painless params:map[scale:1000000] source:ctx.event.duration = Math.round(ctx.temp.duration * params.scale)]] map[remove:map[field:temp.duration ignore_missing:true]] map[urldecode:map[field:user_agent.original ignore_missing:true]] map[user_agent:map[field:user_agent.original ignore_missing:true]] map[grok:map[field:destination.address ignore_failure:true pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:destination.ip}]]] map[grok:map[field:source.address ignore_failure:true pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:source.ip}]]] map[geoip:map[field:source.ip ignore_missing:true target_field:source.geo]] map[geoip:map[database_file:GeoLite2-ASN.mmdb field:source.ip ignore_missing:true properties:[asn organization_name] target_field:source.as]] map[rename:map[field:source.as.asn ignore_missing:true target_field:source.as.number]] map[rename:map[field:source.as.organization_name ignore_missing:true target_field:source.as.organization.name]] map[set:map[field:event.kind value:event]] map[append:map[field:event.category value:web]] map[append:map[field:event.category if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:network]] map[append:map[field:event.type if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:connection]] map[append:map[field:related.ip if:ctx?.source?.ip != null value:{{source.ip}}]] map[append:map[field:related.ip if:ctx?.destination?.ip != null value:{{destination.ip}}]] map[append:map[field:related.user if:ctx?.user?.name != null value:{{user.name}}]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code < 400 value:success]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code >= 400 value:failure]] map[script:map[description:This script processor iterates over the whole document to remove fields with null values. lang:painless source:void handleMap(Map map) {
  for (def x : map.values()) {
    if (x instanceof Map) {
        handleMap(x);
    } else if (x instanceof List) {
        handleList(x);
    }
  }
  map.values().removeIf(v -> v == null);
}
void handleList(List list) {
  for (def x : list) {
      if (x instanceof Map) {
          handleMap(x);
      } else if (x instanceof List) {
          handleList(x);
      }
  }
}
handleMap(ctx);
]]]]
2022-04-26T13:42:21.811+0300	INFO	[modules]	fileset/pipelines.go:133	Elasticsearch pipeline loaded.	{"pipeline": "filebeat-7.15.1-iis-access-pipeline"}
2022-04-26T13:42:21.811+0300	DEBUG	[modules]	fileset/pipelines.go:67	Required processors: [{geoip ingest-geoip}]
2022-04-26T13:42:21.811+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	GET https://10.112.116.167:9200/_nodes/ingest  <nil>
2022-04-26T13:42:21.813+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	PUT https://10.112.116.167:9200/_ingest/pipeline/filebeat-7.15.1-iis-error-pipeline  map[description:Pipeline for parsing IIS error logs. Requires the geoip plugin. on_failure:[map[set:map[field:error.message value:{{ _ingest.on_failure_message }}]]] processors:[map[set:map[field:event.ingested value:{{_ingest.timestamp}}]] map[rename:map[field:message target_field:event.original]] map[grok:map[field:event.original ignore_missing:true patterns:[%{TIMESTAMP_ISO8601:iis.error.time} %{IPORHOST:source.address} %{NUMBER:source.port:long} %{IPORHOST:destination.address} %{IPORHOST:destination.port:long} (?:HTTP/%{NUMBER:http.version}|-) (?:%{WORD:http.request.method}|-) (?:-|%{NOTSPACE:_tmp.url_orig}) (?:%{NUMBER}|-) (?:%{NUMBER:http.response.status_code:long}|-) (?:%{NUMBER}|-) (?:-|%{NOTSPACE:iis.error.reason_phrase}) (?:-|%{NOTSPACE:iis.error.queue_name}) %{TIMESTAMP_ISO8601:iis.error.time} %{IPORHOST:source.address} %{NUMBER:source.port:long} %{IPORHOST:destination.address} %{IPORHOST:destination.port:long} (?:HTTP/%{NUMBER:http.version}|-) (?:%{WORD:http.request.method}|-) (?:-|%{NOTSPACE:_tmp.url_orig}) (?:%{NUMBER:http.response.status_code:long}|-) (?:%{NUMBER}|-) (?:-|%{NOTSPACE:iis.error.reason_phrase}) (?:-|%{NOTSPACE:iis.error.queue_name})]]] map[uri_parts:map[field:_tmp.url_orig ignore_failure:true]] map[set:map[field:url.original if:ctx?._tmp?.url_orig != null && ctx?.url?.original == null ignore_failure:true value:{{{_tmp.url_orig}}}]] map[remove:map[field:[_tmp] ignore_missing:true]] map[rename:map[field:@timestamp target_field:event.created]] map[date:map[field:iis.error.time formats:[yyyy-MM-dd HH:mm:ss] target_field:@timestamp]] map[remove:map[field:iis.error.time]] map[grok:map[field:destination.address pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:destination.ip}]]] map[grok:map[field:source.address pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:source.ip}]]] map[geoip:map[field:source.ip ignore_failure:true target_field:source.geo]] map[geoip:map[database_file:GeoLite2-ASN.mmdb field:source.ip ignore_missing:true properties:[asn organization_name] target_field:source.as]] map[rename:map[field:source.as.asn ignore_missing:true target_field:source.as.number]] map[rename:map[field:source.as.organization_name ignore_missing:true target_field:source.as.organization.name]] map[set:map[field:event.kind value:event]] map[append:map[field:event.category value:web]] map[append:map[field:event.category if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:network]] map[append:map[field:event.type if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:connection]] map[append:map[field:related.ip if:ctx?.source?.ip != null value:{{source.ip}}]] map[append:map[field:related.ip if:ctx?.destination?.ip != null value:{{destination.ip}}]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code < 400 value:success]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code >= 400 value:failure]] map[script:map[description:This script processor iterates over the whole document to remove fields with null values. lang:painless source:void handleMap(Map map) {
  for (def x : map.values()) {
    if (x instanceof Map) {
        handleMap(x);
    } else if (x instanceof List) {
        handleList(x);
    }
  }
  map.values().removeIf(v -> v == null);
}
void handleList(List list) {
  for (def x : list) {
      if (x instanceof Map) {
          handleMap(x);
      } else if (x instanceof List) {
          handleList(x);
      }
  }
}
handleMap(ctx);
]]]]
2022-04-26T13:42:21.846+0300	INFO	[modules]	fileset/pipelines.go:133	Elasticsearch pipeline loaded.	{"pipeline": "filebeat-7.15.1-iis-error-pipeline"}
2022-04-26T13:42:21.846+0300	INFO	cfgfile/reload.go:262	Loading of config files completed.
2022-04-26T13:42:21.846+0300	INFO	[load]	cfgfile/list.go:129	Stopping 1 runners ...
2022-04-26T13:42:21.846+0300	DEBUG	[load]	cfgfile/list.go:140	Stopping runner: iis (access, error)
2022-04-26T13:42:21.846+0300	DEBUG	[load]	cfgfile/list.go:142	Stopped runner: iis (access, error)
2022-04-26T13:42:21.846+0300	DEBUG	[modules]	fileset/pipelines.go:67	Required processors: [{user_agent ingest-user-agent} {geoip ingest-geoip}]
2022-04-26T13:42:21.846+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	GET https://10.112.116.167:9200/_nodes/ingest  <nil>
2022-04-26T13:42:21.851+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	PUT https://10.112.116.167:9200/_ingest/pipeline/filebeat-7.15.1-iis-access-pipeline  map[description:Pipeline for parsing IIS access logs. Requires the geoip and user_agent plugins. on_failure:[map[set:map[field:error.message value:{{ _ingest.on_failure_message }}]]] processors:[map[set:map[field:event.ingested value:{{_ingest.timestamp}}]] map[rename:map[field:message target_field:event.original]] map[grok:map[field:event.original ignore_missing:true patterns:[%{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{NOTSPACE:iis.access.site_name}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:iis.access.cookie}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NOTSPACE:destination.domain}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{NOTSPACE:iis.access.site_name}) (?:-|%{NOTSPACE:iis.access.server_name}) (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|HTTP/%{NUMBER:http.version}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NOTSPACE:iis.access.cookie}) (?:-|%{NOTSPACE:http.request.referrer}) (?:-|%{NOTSPACE:destination.domain}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} \[%{IPORHOST:destination.address}\]\(http://%{IPORHOST:destination.address}\) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) \[%{IPORHOST:source.address}\]\(http://%{IPORHOST:source.address}\) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration})( (?:-|%{IPORHOST:network.forwarded_ip}))? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes}) (?:-|%{IPORHOST:network.forwarded_ip})? %{TIMESTAMP_ISO8601:iis.access.time} (?:-|%{IPORHOST:destination.address}) (?:-|%{WORD:http.request.method}) (?:-|%{NOTSPACE:_tmp.url_path}) (?:-|%{NOTSPACE:_tmp.url_query}) (?:-|%{NUMBER:destination.port}) (?:-|%{NOTSPACE:user.name}) (?:-|%{IPORHOST:source.address}) (?:-|%{NOTSPACE:user_agent.original}) (?:-|%{NUMBER:http.response.status_code}) (?:-|%{NUMBER:iis.access.sub_status}) (?:-|%{NUMBER:iis.access.win32_status}) (?:-|%{NUMBER:temp.duration}) (?:-|%{NUMBER:http.response.body.bytes}) (?:-|%{NUMBER:http.request.body.bytes})]]] map[uri_parts:map[field:_tmp.url_path ignore_failure:true]] map[set:map[field:url.original if:ctx?._tmp?.url_path != null && ctx?.url?.original == null ignore_failure:true value:{{_tmp.url_path}}]] map[urldecode:map[field:_tmp.url_query if:ctx.url?.query == null ignore_failure:true ignore_missing:true target_field:url.query]] map[set:map[field:url.domain if:ctx.url?.domain == null && ctx.destination?.domain != null value:{{destination.domain}}]] map[remove:map[field:[_tmp] ignore_missing:true]] map[rename:map[field:@timestamp target_field:event.created]] map[date:map[field:iis.access.time formats:[yyyy-MM-dd HH:mm:ss] target_field:@timestamp]] map[remove:map[field:iis.access.time]] map[script:map[if:ctx.temp?.duration != null lang:painless params:map[scale:1000000] source:ctx.event.duration = Math.round(ctx.temp.duration * params.scale)]] map[remove:map[field:temp.duration ignore_missing:true]] map[urldecode:map[field:user_agent.original ignore_missing:true]] map[user_agent:map[field:user_agent.original ignore_missing:true]] map[grok:map[field:destination.address ignore_failure:true pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:destination.ip}]]] map[grok:map[field:source.address ignore_failure:true pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:source.ip}]]] map[geoip:map[field:source.ip ignore_missing:true target_field:source.geo]] map[geoip:map[database_file:GeoLite2-ASN.mmdb field:source.ip ignore_missing:true properties:[asn organization_name] target_field:source.as]] map[rename:map[field:source.as.asn ignore_missing:true target_field:source.as.number]] map[rename:map[field:source.as.organization_name ignore_missing:true target_field:source.as.organization.name]] map[set:map[field:event.kind value:event]] map[append:map[field:event.category value:web]] map[append:map[field:event.category if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:network]] map[append:map[field:event.type if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:connection]] map[append:map[field:related.ip if:ctx?.source?.ip != null value:{{source.ip}}]] map[append:map[field:related.ip if:ctx?.destination?.ip != null value:{{destination.ip}}]] map[append:map[field:related.user if:ctx?.user?.name != null value:{{user.name}}]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code < 400 value:success]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code >= 400 value:failure]] map[script:map[description:This script processor iterates over the whole document to remove fields with null values. lang:painless source:void handleMap(Map map) {
  for (def x : map.values()) {
    if (x instanceof Map) {
        handleMap(x);
    } else if (x instanceof List) {
        handleList(x);
    }
  }
  map.values().removeIf(v -> v == null);
}
void handleList(List list) {
  for (def x : list) {
      if (x instanceof Map) {
          handleMap(x);
      } else if (x instanceof List) {
          handleList(x);
      }
  }
}
handleMap(ctx);
]]]]
2022-04-26T13:42:21.912+0300	INFO	[modules]	fileset/pipelines.go:133	Elasticsearch pipeline loaded.	{"pipeline": "filebeat-7.15.1-iis-access-pipeline"}
2022-04-26T13:42:21.912+0300	DEBUG	[modules]	fileset/pipelines.go:67	Required processors: [{geoip ingest-geoip}]
2022-04-26T13:42:21.912+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	GET https://10.112.116.167:9200/_nodes/ingest  <nil>
2022-04-26T13:42:21.915+0300	DEBUG	[esclientleg]	eslegclient/connection.go:328	PUT https://10.112.116.167:9200/_ingest/pipeline/filebeat-7.15.1-iis-error-pipeline  map[description:Pipeline for parsing IIS error logs. Requires the geoip plugin. on_failure:[map[set:map[field:error.message value:{{ _ingest.on_failure_message }}]]] processors:[map[set:map[field:event.ingested value:{{_ingest.timestamp}}]] map[rename:map[field:message target_field:event.original]] map[grok:map[field:event.original ignore_missing:true patterns:[%{TIMESTAMP_ISO8601:iis.error.time} %{IPORHOST:source.address} %{NUMBER:source.port:long} %{IPORHOST:destination.address} %{IPORHOST:destination.port:long} (?:HTTP/%{NUMBER:http.version}|-) (?:%{WORD:http.request.method}|-) (?:-|%{NOTSPACE:_tmp.url_orig}) (?:%{NUMBER}|-) (?:%{NUMBER:http.response.status_code:long}|-) (?:%{NUMBER}|-) (?:-|%{NOTSPACE:iis.error.reason_phrase}) (?:-|%{NOTSPACE:iis.error.queue_name}) %{TIMESTAMP_ISO8601:iis.error.time} %{IPORHOST:source.address} %{NUMBER:source.port:long} %{IPORHOST:destination.address} %{IPORHOST:destination.port:long} (?:HTTP/%{NUMBER:http.version}|-) (?:%{WORD:http.request.method}|-) (?:-|%{NOTSPACE:_tmp.url_orig}) (?:%{NUMBER:http.response.status_code:long}|-) (?:%{NUMBER}|-) (?:-|%{NOTSPACE:iis.error.reason_phrase}) (?:-|%{NOTSPACE:iis.error.queue_name})]]] map[uri_parts:map[field:_tmp.url_orig ignore_failure:true]] map[set:map[field:url.original if:ctx?._tmp?.url_orig != null && ctx?.url?.original == null ignore_failure:true value:{{{_tmp.url_orig}}}]] map[remove:map[field:[_tmp] ignore_missing:true]] map[rename:map[field:@timestamp target_field:event.created]] map[date:map[field:iis.error.time formats:[yyyy-MM-dd HH:mm:ss] target_field:@timestamp]] map[remove:map[field:iis.error.time]] map[grok:map[field:destination.address pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:destination.ip}]]] map[grok:map[field:source.address pattern_definitions:map[NOZONEIP:[^%]*] patterns:[%{NOZONEIP:source.ip}]]] map[geoip:map[field:source.ip ignore_failure:true target_field:source.geo]] map[geoip:map[database_file:GeoLite2-ASN.mmdb field:source.ip ignore_missing:true properties:[asn organization_name] target_field:source.as]] map[rename:map[field:source.as.asn ignore_missing:true target_field:source.as.number]] map[rename:map[field:source.as.organization_name ignore_missing:true target_field:source.as.organization.name]] map[set:map[field:event.kind value:event]] map[append:map[field:event.category value:web]] map[append:map[field:event.category if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:network]] map[append:map[field:event.type if:ctx?.source?.ip != null && ctx?.destination?.ip != null value:connection]] map[append:map[field:related.ip if:ctx?.source?.ip != null value:{{source.ip}}]] map[append:map[field:related.ip if:ctx?.destination?.ip != null value:{{destination.ip}}]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code < 400 value:success]] map[set:map[field:event.outcome if:ctx?.http?.response?.status_code != null && ctx.http.response.status_code >= 400 value:failure]] map[script:map[description:This script processor iterates over the whole document to remove fields with null values. lang:painless source:void handleMap(Map map) {
  for (def x : map.values()) {
    if (x instanceof Map) {
        handleMap(x);
    } else if (x instanceof List) {
        handleList(x);
    }
  }
  map.values().removeIf(v -> v == null);
}
void handleList(List list) {
  for (def x : list) {
      if (x instanceof Map) {
          handleMap(x);
      } else if (x instanceof List) {
          handleList(x);
      }
  }
}
handleMap(ctx);
]]]]
2022-04-26T13:42:21.949+0300	INFO	[modules]	fileset/pipelines.go:133	Elasticsearch pipeline loaded.	{"pipeline": "filebeat-7.15.1-iis-error-pipeline"}
